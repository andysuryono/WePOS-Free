/**
 * Filename: cashflow.penerimaanKas.js
 * Generated 2019-03-07 at 01:42:46 AM
 */
Ext.define('ExtApp.modules.cashflow.model.model_penerimaanKas',{extend:'Ext.data.Model',alias:'model_penerimaanKas',fields:[{name:'id',type:'int'},{name:'km_no',type:'string'},{name:'km_date',type:'string'},{name:'km_name',type:'string'},{name:'km_atasnama',type:'string'},{name:'old_km_tujuan',type:'string'},{name:'km_tujuan',type:'string'},{name:'km_tujuan_text',type:'string'},{name:'km_status',type:'string'},{name:'km_status_text',type:'string'},{name:'no_ref',type:'string'},{name:'no_ref_text',type:'string'},{name:'ref_id',type:'int'},{name:'km_total',type:'string'},{name:'km_total_show',type:'string'},{name:'km_notes',type:'string'},{name:'autoposting_id',type:'int'},{name:'autoposting_name',type:'string'},{name:'jurnal_id',type:'int'},{name:'jurnal_no',type:'string'},{name:'posting_no',type:'string'},{name:'km_used',type:'string'},{name:'km_used_text',type:'string'},{name:'km_tipe',type:'string'},{name:'km_tipe_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'cashflow/penerimaanKas/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.cashflow.model.model_tujuanPenerimaan',{extend:'Ext.data.Model',alias:'model_tujuanPenerimaan',fields:[{name:'id',type:'int'},{name:'tujuan_cashflow_name',type:'string'},{name:'tujuan_cashflow_tipe',type:'string'},{name:'rek_id_debet',type:'int'},{name:'rek_id_debet_name',type:'string'},{name:'rek_id_kredit',type:'int'},{name:'rek_id_kredit_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'cashflow/tujuanPenerimaan/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.accounting.model.model_accAutoPosting',{extend:'Ext.data.Model',alias:'model_accAutoPosting',fields:[{name:'id',type:'int'},{name:'autoposting_name',type:'string'},{name:'autoposting_tipe',type:'string'},{name:'rek_id_debet',type:'string'},{name:'rek_id_debet_name',type:'string'},{name:'rek_id_kredit',type:'string'},{name:'rek_id_kredit_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'accounting/accAutoPosting/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.cashflow.store.store_penerimaanKas',{extend:'Ext.data.Store',model:'ExtApp.modules.cashflow.model.model_penerimaanKas',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.cashflow.store.store_tujuanPenerimaan',{extend:'Ext.data.Store',model:'ExtApp.modules.cashflow.model.model_tujuanPenerimaan',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.accounting.store.store_accAutoPosting',{extend:'Ext.data.Store',model:'ExtApp.modules.accounting.model.model_accAutoPosting',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.cashflow.view.penerimaanKas",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_penerimaanKas_grid=theApp.getStore('store_penerimaanKas_grid',false);if(store_penerimaanKas_grid==false){store_penerimaanKas_grid=theApp.copyStore('cashflow','store_penerimaanKas','store_penerimaanKas_grid');}
var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_penerimaanKas=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_penerimaanKas').down('#deleteButton_penerimaanKas').setDisabled(selections.length==0);}}});me.pagingtb_penerimaanKas=helperGrid.paging({ds:store_penerimaanKas_grid,title:'Penerimaan Kas'});return desktop.createWindow({id:me.id,title:'Penerimaan Kas',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_penerimaanKas',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: KM.No, Dari, Ref.No',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_penerimaanKas();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('01-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('t-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_penerimaanKas',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_penerimaanKas();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_penerimaanKas',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_penerimaanKas').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-m-Y'));form.findField('date_till').setValue(phpJs.date('t-m-Y'));me.search_penerimaanKas();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_penerimaanKas_grid,id:'grid_penerimaanKas',scroll:true,selModel:selModel_penerimaanKas,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'jurnal_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'km_status',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'km_no',text:'Penerimaan.No',width:130},{xtype:'gridcolumn',dataIndex:'km_date',text:'Tanggal',width:100},{xtype:'gridcolumn',dataIndex:'km_status_text',text:'Status',width:100,align:'center'},{xtype:'gridcolumn',dataIndex:'km_total_show',text:'Total',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'no_ref_text',text:'No.Bukti',width:120},{xtype:'gridcolumn',dataIndex:'km_atasnama',text:'Dari',width:150},{xtype:'gridcolumn',dataIndex:'km_name',text:'Penerima',width:150},{xtype:'gridcolumn',dataIndex:'km_tujuan_text',text:'Tujuan',width:200},{xtype:'gridcolumn',dataIndex:'jurnal_no',text:'Jurnal No',width:150},{xtype:'gridcolumn',dataIndex:'posting_no',text:'Posting No',width:150}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_penerimaanKas').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_penerimaanKas');}}},bbar:me.pagingtb_penerimaanKas,dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_penerimaanKas',tooltip:'Filter Penerimaan Kas',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_penerimaanKas').toggleCollapse();}}},'->',{text:'Add',itemId:'addButton_penerimaanKas',tooltip:'Add Penerimaan Kas',iconCls:'btn-add',listeners:{click:function(){me.formType='add';me.createWindow(me,'add_penerimaanKas');}}},'-',{text:'Cancel',itemId:'deleteButton_penerimaanKas',tooltip:'Cancel Penerimaan Kas',iconCls:'btn-delete',disabled:true,listeners:{click:function(){var getSelection=Ext.getCmp('grid_penerimaanKas').getSelectionModel().selected;if(getSelection.length>0){if(getSelection.length>1){ExtApp.Msg.warning('Select only 1 data!');return false;}
me.delete_data=getSelection.items[0].data;if(me.delete_data.km_status=='pengakuan'||me.delete_data.km_status=='posting'){me.deleteConfirm_penerimaanKas();}else{ExtApp.Msg.warning('Cannot Cancel '+me.delete_data.km_no+'<br/>Status Penerimaan Kas: '+me.delete_data.km_status);}}else{ExtApp.Msg.info('Please Select Penerimaan Kas!');}}}},'-',{text:'Refresh',itemId:'refreshButton_penerimaanKas',tooltip:'Refresh Penerimaan Kas',iconCls:'btn-refresh',listeners:{click:function(){me.search_penerimaanKas();}}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_penerimaanKas').toggleCollapse();me.search_penerimaanKas();},show:function(){}}});},add_penerimaanKas:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Tambah Penerimaan Kas ';if(me.formType=='edit'){Titletext='Ubah Penerimaan Kas ';}
var is_cashflow_non_accounting=opt_cashflow_non_accounting;var store_accAutoPosting_addPenerimaan=theApp.getStore('store_accAutoPosting_addPenerimaan',false);if(store_accAutoPosting_addPenerimaan==false){store_accAutoPosting_addPenerimaan=theApp.copyStore('accounting','store_accAutoPosting','store_accAutoPosting_addPenerimaan');}
store_accAutoPosting_addPenerimaan.proxy.extraParams.autoposting_tipe='cashflow_penerimaan';store_accAutoPosting_addPenerimaan.proxy.extraParams.keywords='';var store_tujuanPenerimaan_addPenerimaan=theApp.getStore('store_tujuanPenerimaan_addPenerimaan',false);if(store_tujuanPenerimaan_addPenerimaan==false){store_tujuanPenerimaan_addPenerimaan=theApp.copyStore('cashflow','store_tujuanPenerimaan','store_tujuanPenerimaan_addPenerimaan');}
store_tujuanPenerimaan_addPenerimaan.proxy.extraParams.keywords='';var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_add_penerimaanKas',title:Titletext,width:700,height:320,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_penerimaanKas',border:0,bodyPadding:10,border:true,margin:'0 0 0 0',items:[{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:350,border:false,margin:'0 40 0 0',items:[{xtype:'hidden',name:'form_type_penerimaanKas',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'ref_id'},{xtype:'hidden',name:'km_tipe'},{xtype:'hidden',name:'supplier_id'},{xtype:'hidden',name:'jurnal_id'},{xtype:'hidden',name:'km_status'},{xtype:'hidden',name:'old_km_tujuan'},{xtype:'hidden',name:'km_tujuan'},{xtype:'hidden',name:'autoposting_id'},{xtype:'hidden',name:'cashflow_non_accounting'},{xtype:'hidden',name:'km_info'},{xtype:'textfield',name:'km_no',fieldLabel:'Penerimaan. No',width:250,value:'Auto',labelWidth:120,labelSeparator:'',readOnly:true},{xtype:'datefield',name:'km_date',width:250,fieldLabel:'Tgl Penerimaan',format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false,labelWidth:120,labelSeparator:''},{xtype:'textfield',name:'km_atasnama',fieldLabel:'Diterima Dari',width:350,allowBlank:false,labelWidth:120,labelSeparator:''},{xtype:'textfield',name:'km_name',fieldLabel:'Penerima',width:350,allowBlank:false,labelWidth:120,labelSeparator:''},{xtype:'textfield',name:'no_ref',fieldLabel:'No.Ref/Bukti',width:350,allowBlank:false,labelWidth:120,labelSeparator:''}]},{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:260,border:false,margin:'0 10 0 0',items:[{xtype:'displayfield',name:'km_status_text',fieldLabel:'Status',width:250,labelWidth:80,labelSeparator:''},{xtype:'textfield',name:'jurnal_no',fieldLabel:'Jurnal No',value:'Auto',width:250,labelWidth:80,labelSeparator:'',readOnly:true},{xtype:'textfield',name:'posting_no',fieldLabel:'Posting No',value:'Auto',width:250,labelWidth:80,labelSeparator:'',readOnly:true},{xtype:'textfield',name:'km_total',fieldLabel:'Total Terima',width:250,labelWidth:80,allowBlank:false,labelSeparator:'',listeners:{blur:function(field,val){var form=Ext.getCmp('form_penerimaanKas').getForm();form.findField('km_total').setValue(phpJs.priceFormat(form.findField('km_total').getValue()));},focus:function(){var form=Ext.getCmp('form_penerimaanKas').getForm();var get_km_total=phpJs.numberFormat(form.findField('km_total').getValue());if(get_km_total==0){get_km_total='';}
form.findField('km_total').setValue(get_km_total);}}}]}]},{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'combobox',name:'km_tujuan_text',fieldLabel:'Tujuan',emptyText:'Pilih',width:650,store:store_tujuanPenerimaan_addPenerimaan,displayField:'tujuan_cashflow_name',valueField:'id',queryMode:'local',allowBlank:false,labelWidth:120,labelSeparator:'',margin:'0 0 5 0',listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_penerimaanKas').getForm();form2.findField('km_tujuan').setValue(records[0].data.id);}}},{xtype:'combobox',name:'autoposting_name',fieldLabel:'Jenis Penerimaan',emptyText:'Pilih',width:650,store:store_accAutoPosting_addPenerimaan,displayField:'autoposting_name',valueField:'id',queryMode:'local',allowBlank:false,labelWidth:120,labelSeparator:'',margin:'0 0 5 0',listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_penerimaanKas').getForm();form2.findField('autoposting_id').setValue(records[0].data.id);}}},{xtype:'textfield',name:'km_notes',fieldLabel:'Notes',width:650,labelWidth:120,labelSeparator:''}]}]}],buttons:[{text:'Save to Jurnal',formBind:true,id:'btnJurnal_penerimaanKas',iconCls:'btn-posting',disabled:true,handler:function(){ExtApp.Msg.confirm('Save to Jurnal?</b></i>',false,function(btn){if(btn=='yes'){me.saveJurnal_penerimaanKas();}else{return false;}});}},{text:'Posting Jurnal',formBind:true,id:'btnPosting_penerimaanKas',iconCls:'btn-posting',disabled:true,handler:function(){ExtApp.Msg.confirm('Posting Jurnal?</b></i>',false,function(btn){if(btn=='yes'){me.save_penerimaanKas(1);}else{return false;}});}},'->',{text:'Save',formBind:true,id:'btnSave_penerimaanKas',iconCls:'btn-save',handler:function(){me.save_penerimaanKas(0);}},{text:'Close',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_penerimaanKas');}}],listeners:{show:function(){var form=Ext.getCmp('form_penerimaanKas').getForm();form.reset();Ext.getCmp('btnJurnal_penerimaanKas').hide();Ext.getCmp('btnPosting_penerimaanKas').hide();Ext.getCmp('btnSave_penerimaanKas').setDisabled(false);if(is_cashflow_non_accounting==1){form.findField('cashflow_non_accounting').setValue(1);}else{form.findField('cashflow_non_accounting').setValue(0);}
if(form.findField('form_type_penerimaanKas').getValue()=='add'){form.findField('km_date').setValue(phpJs.date("d-m-Y"));form.findField('km_date').setReadOnly(false);store_accAutoPosting_addPenerimaan.load({callback:function(){}});store_tujuanPenerimaan_addPenerimaan.load({callback:function(){}});form.findField('km_status').setValue("pengakuan");form.findField('km_status_text').setValue('<font color="blue">Pengakuan</font>');form.findField('km_info').setValue("");var val={payment_type:1};Ext.getCmp('payment_id_group_penerimaanKas').setValue(val);}else{if(me.edit_data.jurnal_no==''){me.edit_data.jurnal_no='-';}
if(me.edit_data.posting_no==''){me.edit_data.posting_no='-';}
form.setValues(me.edit_data);form.findField('km_date').setReadOnly(true);form.findField('km_name').setReadOnly(true);form.findField('km_atasnama').setReadOnly(false);form.findField('no_ref').setReadOnly(true);form.findField('km_total').setReadOnly(true);form.findField('autoposting_name').setDisabled(true);form.findField('km_tujuan_text').setDisabled(true);form.findField('km_info').setValue("");form.findField('km_total').setValue(me.edit_data.km_total_show);if(me.edit_data.km_status=='pengakuan'){if(is_cashflow_non_accounting==1){}else{Ext.getCmp('btnJurnal_penerimaanKas').setDisabled(false);Ext.getCmp('btnJurnal_penerimaanKas').show();}
form.findField('km_date').setReadOnly(true);form.findField('km_name').setReadOnly(false);form.findField('no_ref').setReadOnly(false);form.findField('km_total').setReadOnly(false);form.findField('autoposting_name').setDisabled(false);form.findField('km_tujuan_text').setDisabled(false);if(me.edit_data.km_tipe!='umum'){form.findField('km_date').setReadOnly(true);form.findField('no_ref').setReadOnly(true);form.findField('km_total').setReadOnly(true);form.findField('autoposting_name').setDisabled(true);form.findField('km_tujuan_text').setDisabled(true);}}else
if(me.edit_data.km_status=='jurnal'){}else
if(me.edit_data.km_status=='posting'){if(is_cashflow_non_accounting==1){form.findField('km_date').setReadOnly(false);form.findField('km_total').setReadOnly(false);form.findField('autoposting_name').setDisabled(false);form.findField('km_tujuan_text').setDisabled(false);}
if(me.edit_data.km_tipe!='umum'){form.findField('km_date').setReadOnly(true);form.findField('no_ref').setReadOnly(true);form.findField('km_total').setReadOnly(true);form.findField('autoposting_name').setDisabled(true);form.findField('km_tujuan_text').setDisabled(true);}}
store_accAutoPosting_addPenerimaan.load({callback:function(){form.findField('autoposting_name').setValue(me.edit_data.autoposting_name);}});store_tujuanPenerimaan_addPenerimaan.load({callback:function(){form.findField('km_tujuan_text').setValue(me.edit_data.km_tujuan_text);}});}
me.reset_penerimaanKasDetail();}}});}});