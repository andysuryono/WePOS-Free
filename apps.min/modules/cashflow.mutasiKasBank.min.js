/**
 * Filename: cashflow.mutasiKasBank.js
 * Generated 2019-03-07 at 01:43:11 AM
 */
Ext.define('ExtApp.modules.cashflow.model.model_mutasiKasBank',{extend:'Ext.data.Model',alias:'model_mutasiKasBank',fields:[{name:'id',type:'int'},{name:'mkb_no',type:'string'},{name:'mkb_date',type:'string'},{name:'mkb_name',type:'string'},{name:'old_mkb_tujuan',type:'string'},{name:'mkb_tujuan',type:'string'},{name:'mkb_tujuan_text',type:'string'},{name:'mkb_status',type:'string'},{name:'mkb_status_text',type:'string'},{name:'no_ref',type:'string'},{name:'mkb_total',type:'string'},{name:'mkb_total_show',type:'string'},{name:'mkb_notes',type:'string'},{name:'autoposting_id',type:'int'},{name:'autoposting_name',type:'string'},{name:'jurnal_id',type:'int'},{name:'jurnal_no',type:'string'},{name:'posting_no',type:'string'},{name:'mkb_used',type:'string'},{name:'mkb_used_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'cashflow/mutasiKasBank/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.cashflow.model.model_tujuanMutasiKasBank',{extend:'Ext.data.Model',alias:'model_tujuanMutasiKasBank',fields:[{name:'id',type:'int'},{name:'tujuan_cashflow_name',type:'string'},{name:'tujuan_cashflow_tipe',type:'string'},{name:'rek_id_debet',type:'int'},{name:'rek_id_debet_name',type:'string'},{name:'rek_id_kredit',type:'int'},{name:'rek_id_kredit_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'cashflow/tujuanMutasiKasBank/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.accounting.model.model_accAutoPosting',{extend:'Ext.data.Model',alias:'model_accAutoPosting',fields:[{name:'id',type:'int'},{name:'autoposting_name',type:'string'},{name:'autoposting_tipe',type:'string'},{name:'rek_id_debet',type:'string'},{name:'rek_id_debet_name',type:'string'},{name:'rek_id_kredit',type:'string'},{name:'rek_id_kredit_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'accounting/accAutoPosting/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.cashflow.store.store_mutasiKasBank',{extend:'Ext.data.Store',model:'ExtApp.modules.cashflow.model.model_mutasiKasBank',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.cashflow.store.store_tujuanMutasiKasBank',{extend:'Ext.data.Store',model:'ExtApp.modules.cashflow.model.model_tujuanMutasiKasBank',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.accounting.store.store_accAutoPosting',{extend:'Ext.data.Store',model:'ExtApp.modules.accounting.model.model_accAutoPosting',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.cashflow.view.mutasiKasBank",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_mutasiKasBank_grid=theApp.getStore('store_mutasiKasBank_grid',false);if(store_mutasiKasBank_grid==false){store_mutasiKasBank_grid=theApp.copyStore('cashflow','store_mutasiKasBank','store_mutasiKasBank_grid');}
var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_mutasiKasBank=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_mutasiKasBank').down('#deleteButton_mutasiKasBank').setDisabled(selections.length==0);}}});me.pagingtb_mutasiKasBank=helperGrid.paging({ds:store_mutasiKasBank_grid,title:'Mutasi Kas Bank'});return desktop.createWindow({id:me.id,title:'Mutasi Kas Bank',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_mutasiKasBank',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: MKB.No, Nama, Ref.No',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_mutasiKasBank();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('01-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('t-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_mutasiKasBank',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_mutasiKasBank();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_mutasiKasBank',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_mutasiKasBank').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-m-Y'));form.findField('date_till').setValue(phpJs.date('t-m-Y'));me.search_mutasiKasBank();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_mutasiKasBank_grid,id:'grid_mutasiKasBank',scroll:true,selModel:selModel_mutasiKasBank,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'jurnal_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'mkb_status',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'mkb_no',text:'Mutasi Kas.No',width:130},{xtype:'gridcolumn',dataIndex:'mkb_date',text:'Tanggal',width:100},{xtype:'gridcolumn',dataIndex:'mkb_status_text',text:'Status',width:100,align:'center'},{xtype:'gridcolumn',dataIndex:'mkb_total_show',text:'Total',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'no_ref',text:'No.Bukti',width:120},{xtype:'gridcolumn',dataIndex:'mkb_name',text:'Nama/Pelaksana',width:150},{xtype:'gridcolumn',dataIndex:'mkb_tujuan_text',text:'Tujuan',width:200},{xtype:'gridcolumn',dataIndex:'jurnal_no',text:'Jurnal No',width:150},{xtype:'gridcolumn',dataIndex:'posting_no',text:'Posting No',width:150}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_mutasiKasBank').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_mutasiKasBank');}}},bbar:me.pagingtb_mutasiKasBank,dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_mutasiKasBank',tooltip:'Filter Mutasi Kas Bank',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_mutasiKasBank').toggleCollapse();}}},'->',{text:'Add',itemId:'addButton_mutasiKasBank',tooltip:'Add Mutasi Kas Bank',iconCls:'btn-add',listeners:{click:function(){me.formType='add';me.createWindow(me,'add_mutasiKasBank');}}},'-',{text:'Cancel',itemId:'deleteButton_mutasiKasBank',tooltip:'Cancel Mutasi Kas Bank',iconCls:'btn-delete',disabled:true,listeners:{click:function(){var getSelection=Ext.getCmp('grid_mutasiKasBank').getSelectionModel().selected;if(getSelection.length>0){if(getSelection.length>1){ExtApp.Msg.warning('Select only 1 data!');return false;}
me.delete_data=getSelection.items[0].data;if(me.delete_data.mkb_status=='pengakuan'||me.delete_data.mkb_status=='posting'){me.deleteConfirm_mutasiKasBank();}else{ExtApp.Msg.warning('Cannot Cancel '+me.delete_data.mkb_no+'<br/>Status Mutasi Kas Bank: '+me.delete_data.mkb_status);}}else{ExtApp.Msg.info('Please Select Mutasi Kas Bank!');}}}},'-',{text:'Refresh',itemId:'refreshButton_mutasiKasBank',tooltip:'Refresh Mutasi Kas Bank',iconCls:'btn-refresh',listeners:{click:function(){me.search_mutasiKasBank();}}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_mutasiKasBank').toggleCollapse();me.search_mutasiKasBank();},show:function(){}}});},add_mutasiKasBank:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Tambah Mutasi Kas Bank ';if(me.formType=='edit'){Titletext='Ubah Mutasi Kas Bank ';}
var is_cashflow_non_accounting=opt_cashflow_non_accounting;var store_accAutoPosting_addMutasiKasBank=theApp.getStore('store_accAutoPosting_addMutasiKasBank',false);if(store_accAutoPosting_addMutasiKasBank==false){store_accAutoPosting_addMutasiKasBank=theApp.copyStore('accounting','store_accAutoPosting','store_accAutoPosting_addMutasiKasBank');}
store_accAutoPosting_addMutasiKasBank.proxy.extraParams.autoposting_tipe='cashflow_mutasi_kas_bank';store_accAutoPosting_addMutasiKasBank.proxy.extraParams.keywords='';var store_tujuanMutasiKasBank_addMutasiKasBank=theApp.getStore('store_tujuanMutasiKasBank_addMutasiKasBank',false);if(store_tujuanMutasiKasBank_addMutasiKasBank==false){store_tujuanMutasiKasBank_addMutasiKasBank=theApp.copyStore('cashflow','store_tujuanMutasiKasBank','store_tujuanMutasiKasBank_addMutasiKasBank');}
store_tujuanMutasiKasBank_addMutasiKasBank.proxy.extraParams.keywords='';var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_add_mutasiKasBank',title:Titletext,width:700,height:320,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_mutasiKasBank',border:0,bodyPadding:10,border:true,margin:'0 0 0 0',items:[{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:350,border:false,margin:'0 40 0 0',items:[{xtype:'hidden',name:'form_type_mutasiKasBank',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'ref_id'},{xtype:'hidden',name:'supplier_id'},{xtype:'hidden',name:'jurnal_id'},{xtype:'hidden',name:'mkb_status'},{xtype:'hidden',name:'old_mkb_tujuan'},{xtype:'hidden',name:'mkb_tujuan'},{xtype:'hidden',name:'autoposting_id'},{xtype:'hidden',name:'cashflow_non_accounting'},{xtype:'hidden',name:'mkb_info'},{xtype:'textfield',name:'mkb_no',fieldLabel:'Mutasi Kas. No',width:250,value:'Auto',labelWidth:120,labelSeparator:'',readOnly:true},{xtype:'datefield',name:'mkb_date',width:250,fieldLabel:'Tgl Mutasi',format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false,labelWidth:120,labelSeparator:''},{xtype:'textfield',name:'mkb_name',fieldLabel:'Nama/Pelaksana',width:350,allowBlank:false,labelWidth:120,labelSeparator:''},{xtype:'textfield',name:'no_ref',fieldLabel:'No.Bukti',width:350,allowBlank:false,labelWidth:120,labelSeparator:''}]},{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:260,border:false,margin:'0 10 0 0',items:[{xtype:'displayfield',name:'mkb_status_text',fieldLabel:'Status',width:250,labelWidth:80,labelSeparator:''},{xtype:'textfield',name:'jurnal_no',fieldLabel:'Jurnal No',value:'Auto',width:250,labelWidth:80,labelSeparator:'',readOnly:true},{xtype:'textfield',name:'posting_no',fieldLabel:'Posting No',value:'Auto',width:250,labelWidth:80,labelSeparator:'',readOnly:true},{xtype:'textfield',name:'mkb_total',fieldLabel:'Total Mutasi',width:250,labelWidth:80,allowBlank:false,labelSeparator:'',listeners:{blur:function(field,val){var form=Ext.getCmp('form_mutasiKasBank').getForm();form.findField('mkb_total').setValue(phpJs.priceFormat(form.findField('mkb_total').getValue()));},focus:function(){var form=Ext.getCmp('form_mutasiKasBank').getForm();var get_mkb_total=phpJs.numberFormat(form.findField('mkb_total').getValue());if(get_mkb_total==0){get_mkb_total='';}
form.findField('mkb_total').setValue(get_mkb_total);}}}]}]},{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'combobox',name:'mkb_tujuan_text',fieldLabel:'Tujuan',emptyText:'Pilih',width:650,store:store_tujuanMutasiKasBank_addMutasiKasBank,displayField:'tujuan_cashflow_name',valueField:'id',queryMode:'local',allowBlank:false,labelWidth:120,labelSeparator:'',margin:'0 0 5 0',listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_mutasiKasBank').getForm();form2.findField('mkb_tujuan').setValue(records[0].data.id);}}},{xtype:'combobox',name:'autoposting_name',fieldLabel:'Jenis Mutasi Kas',emptyText:'Pilih',width:650,store:store_accAutoPosting_addMutasiKasBank,displayField:'autoposting_name',valueField:'id',queryMode:'local',allowBlank:false,labelWidth:120,labelSeparator:'',margin:'0 0 5 0',listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_mutasiKasBank').getForm();form2.findField('autoposting_id').setValue(records[0].data.id);}}},{xtype:'textfield',name:'mkb_notes',fieldLabel:'Notes',width:650,labelWidth:120,labelSeparator:''}]}]}],buttons:[{text:'Save to Jurnal',formBind:true,id:'btnJurnal_mutasiKasBank',iconCls:'btn-posting',disabled:true,handler:function(){ExtApp.Msg.confirm('Save to Jurnal?</b></i>',false,function(btn){if(btn=='yes'){me.saveJurnal_mutasiKasBank();}else{return false;}});}},{text:'Posting Jurnal',formBind:true,id:'btnPosting_mutasiKasBank',iconCls:'btn-posting',disabled:true,handler:function(){ExtApp.Msg.confirm('Posting Jurnal?</b></i>',false,function(btn){if(btn=='yes'){me.save_mutasiKasBank(1);}else{return false;}});}},'->',{text:'Save',formBind:true,id:'btnSave_mutasiKasBank',iconCls:'btn-save',handler:function(){me.save_mutasiKasBank(0);}},{text:'Close',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_mutasiKasBank');}}],listeners:{show:function(){var form=Ext.getCmp('form_mutasiKasBank').getForm();form.reset();Ext.getCmp('btnJurnal_mutasiKasBank').hide();Ext.getCmp('btnPosting_mutasiKasBank').hide();Ext.getCmp('btnSave_mutasiKasBank').setDisabled(false);if(is_cashflow_non_accounting==1){form.findField('cashflow_non_accounting').setValue(1);}else{form.findField('cashflow_non_accounting').setValue(0);}
if(form.findField('form_type_mutasiKasBank').getValue()=='add'){form.findField('mkb_date').setValue(phpJs.date("d-m-Y"));form.findField('mkb_date').setReadOnly(false);store_accAutoPosting_addMutasiKasBank.load({callback:function(){}});store_tujuanMutasiKasBank_addMutasiKasBank.load({callback:function(){}});form.findField('mkb_status').setValue("pengakuan");form.findField('mkb_status_text').setValue('<font color="blue">Pengakuan</font>');form.findField('mkb_info').setValue("");var val={payment_type:1};Ext.getCmp('payment_id_group_mutasiKasBank').setValue(val);}else{if(me.edit_data.jurnal_no==''){me.edit_data.jurnal_no='-';}
if(me.edit_data.posting_no==''){me.edit_data.posting_no='-';}
form.setValues(me.edit_data);form.findField('mkb_date').setReadOnly(true);form.findField('mkb_name').setReadOnly(true);form.findField('no_ref').setReadOnly(true);form.findField('mkb_total').setReadOnly(true);form.findField('autoposting_name').setDisabled(true);form.findField('mkb_tujuan_text').setDisabled(true);form.findField('mkb_info').setValue("");form.findField('mkb_total').setValue(me.edit_data.mkb_total_show);if(me.edit_data.mkb_status=='pengakuan'){if(is_cashflow_non_accounting==1){}else{Ext.getCmp('btnJurnal_mutasiKasBank').setDisabled(false);Ext.getCmp('btnJurnal_mutasiKasBank').show();}
form.findField('mkb_date').setReadOnly(true);form.findField('mkb_name').setReadOnly(false);form.findField('no_ref').setReadOnly(false);form.findField('mkb_total').setReadOnly(false);form.findField('autoposting_name').setDisabled(false);form.findField('mkb_tujuan_text').setDisabled(false);}else
if(me.edit_data.mkb_status=='jurnal'){}else
if(me.edit_data.mkb_status=='posting'){if(is_cashflow_non_accounting==1){form.findField('mkb_date').setReadOnly(false);form.findField('mkb_total').setReadOnly(false);form.findField('autoposting_name').setDisabled(false);form.findField('mkb_tujuan_text').setDisabled(false);}}
store_accAutoPosting_addMutasiKasBank.load({callback:function(){form.findField('autoposting_name').setValue(me.edit_data.autoposting_name);}});store_tujuanMutasiKasBank_addMutasiKasBank.load({callback:function(){form.findField('mkb_tujuan_text').setValue(me.edit_data.mkb_tujuan_text);}});}
me.reset_mutasiKasBankDetail();}}});}});