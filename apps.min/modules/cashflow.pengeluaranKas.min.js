/**
 * Filename: cashflow.pengeluaranKas.js
 * Generated 2019-03-07 at 01:42:51 AM
 */
Ext.define('ExtApp.modules.cashflow.model.model_pengeluaranKas',{extend:'Ext.data.Model',alias:'model_pengeluaranKas',fields:[{name:'id',type:'int'},{name:'kk_no',type:'string'},{name:'kk_date',type:'string'},{name:'kk_name',type:'string'},{name:'old_kk_tujuan',type:'string'},{name:'kk_tujuan',type:'string'},{name:'kk_tujuan_text',type:'string'},{name:'kk_status',type:'string'},{name:'kk_status_text',type:'string'},{name:'no_ref',type:'string'},{name:'kk_total',type:'string'},{name:'kk_total_show',type:'string'},{name:'kk_notes',type:'string'},{name:'autoposting_id',type:'int'},{name:'autoposting_name',type:'string'},{name:'jurnal_id',type:'int'},{name:'jurnal_no',type:'string'},{name:'posting_no',type:'string'},{name:'kk_used',type:'string'},{name:'kk_used_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'cashflow/pengeluaranKas/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.cashflow.model.model_tujuanPengeluaran',{extend:'Ext.data.Model',alias:'model_tujuanPengeluaran',fields:[{name:'id',type:'int'},{name:'tujuan_cashflow_name',type:'string'},{name:'tujuan_cashflow_tipe',type:'string'},{name:'rek_id_debet',type:'int'},{name:'rek_id_debet_name',type:'string'},{name:'rek_id_kredit',type:'int'},{name:'rek_id_kredit_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'cashflow/tujuanPengeluaran/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.accounting.model.model_accAutoPosting',{extend:'Ext.data.Model',alias:'model_accAutoPosting',fields:[{name:'id',type:'int'},{name:'autoposting_name',type:'string'},{name:'autoposting_tipe',type:'string'},{name:'rek_id_debet',type:'string'},{name:'rek_id_debet_name',type:'string'},{name:'rek_id_kredit',type:'string'},{name:'rek_id_kredit_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'accounting/accAutoPosting/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.cashflow.store.store_pengeluaranKas',{extend:'Ext.data.Store',model:'ExtApp.modules.cashflow.model.model_pengeluaranKas',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.cashflow.store.store_tujuanPengeluaran',{extend:'Ext.data.Store',model:'ExtApp.modules.cashflow.model.model_tujuanPengeluaran',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.accounting.store.store_accAutoPosting',{extend:'Ext.data.Store',model:'ExtApp.modules.accounting.model.model_accAutoPosting',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.cashflow.view.pengeluaranKas",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_pengeluaranKas_grid=theApp.getStore('store_pengeluaranKas_grid',false);if(store_pengeluaranKas_grid==false){store_pengeluaranKas_grid=theApp.copyStore('cashflow','store_pengeluaranKas','store_pengeluaranKas_grid');}
var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_pengeluaranKas=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_pengeluaranKas').down('#deleteButton_pengeluaranKas').setDisabled(selections.length==0);}}});me.pagingtb_pengeluaranKas=helperGrid.paging({ds:store_pengeluaranKas_grid,title:'Pengeluaran Kas'});return desktop.createWindow({id:me.id,title:'Pengeluaran Kas',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_pengeluaranKas',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: KK.No, Nama, Ref.No',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_pengeluaranKas();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('01-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('t-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_pengeluaranKas',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_pengeluaranKas();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_pengeluaranKas',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_pengeluaranKas').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-m-Y'));form.findField('date_till').setValue(phpJs.date('t-m-Y'));me.search_pengeluaranKas();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_pengeluaranKas_grid,id:'grid_pengeluaranKas',scroll:true,selModel:selModel_pengeluaranKas,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'jurnal_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'kk_status',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'kk_no',text:'Pengeluaran.No',width:130},{xtype:'gridcolumn',dataIndex:'kk_date',text:'Tanggal',width:100},{xtype:'gridcolumn',dataIndex:'kk_status_text',text:'Status',width:100,align:'center'},{xtype:'gridcolumn',dataIndex:'kk_total_show',text:'Total',width:120,align:'right'},{xtype:'gridcolumn',dataIndex:'no_ref',text:'No.Bukti',width:120},{xtype:'gridcolumn',dataIndex:'kk_name',text:'Nama/Pelaksana',width:150},{xtype:'gridcolumn',dataIndex:'kk_tujuan_text',text:'Tujuan',width:200},{xtype:'gridcolumn',dataIndex:'jurnal_no',text:'Jurnal No',width:150},{xtype:'gridcolumn',dataIndex:'posting_no',text:'Posting No',width:150}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_pengeluaranKas').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_pengeluaranKas');}}},bbar:me.pagingtb_pengeluaranKas,dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_pengeluaranKas',tooltip:'Filter Pengeluaran Kas',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_pengeluaranKas').toggleCollapse();}}},'->',{text:'Add',itemId:'addButton_pengeluaranKas',tooltip:'Add Pengeluaran Kas',iconCls:'btn-add',listeners:{click:function(){me.formType='add';me.createWindow(me,'add_pengeluaranKas');}}},'-',{text:'Cancel',itemId:'deleteButton_pengeluaranKas',tooltip:'Cancel Pengeluaran Kas',iconCls:'btn-delete',disabled:true,listeners:{click:function(){var getSelection=Ext.getCmp('grid_pengeluaranKas').getSelectionModel().selected;if(getSelection.length>0){if(getSelection.length>1){ExtApp.Msg.warning('Select only 1 data!');return false;}
me.delete_data=getSelection.items[0].data;if(me.delete_data.kk_status=='pengakuan'||me.delete_data.kk_status=='posting'){me.deleteConfirm_pengeluaranKas();}else{ExtApp.Msg.warning('Cannot Cancel '+me.delete_data.kk_no+'<br/>Status Pengeluaran Kas: '+me.delete_data.kk_status);}}else{ExtApp.Msg.info('Please Select Pengeluaran Kas!');}}}},'-',{text:'Refresh',itemId:'refreshButton_pengeluaranKas',tooltip:'Refresh Pengeluaran Kas',iconCls:'btn-refresh',listeners:{click:function(){me.search_pengeluaranKas();}}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_pengeluaranKas').toggleCollapse();me.search_pengeluaranKas();},show:function(){}}});},add_pengeluaranKas:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Tambah Pengeluaran Kas ';if(me.formType=='edit'){Titletext='Ubah Pengeluaran Kas ';}
var is_cashflow_non_accounting=opt_cashflow_non_accounting;var store_accAutoPosting_addPengeluaran=theApp.getStore('store_accAutoPosting_addPengeluaran',false);if(store_accAutoPosting_addPengeluaran==false){store_accAutoPosting_addPengeluaran=theApp.copyStore('accounting','store_accAutoPosting','store_accAutoPosting_addPengeluaran');}
store_accAutoPosting_addPengeluaran.proxy.extraParams.autoposting_tipe='cashflow_pengeluaran';store_accAutoPosting_addPengeluaran.proxy.extraParams.keywords='';var store_tujuanPengeluaran_addPengeluaran=theApp.getStore('store_tujuanPengeluaran_addPengeluaran',false);if(store_tujuanPengeluaran_addPengeluaran==false){store_tujuanPengeluaran_addPengeluaran=theApp.copyStore('cashflow','store_tujuanPengeluaran','store_tujuanPengeluaran_addPengeluaran');}
store_tujuanPengeluaran_addPengeluaran.proxy.extraParams.keywords='';var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_add_pengeluaranKas',title:Titletext,width:700,height:320,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_pengeluaranKas',border:0,bodyPadding:10,border:true,margin:'0 0 0 0',items:[{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:350,border:false,margin:'0 40 0 0',items:[{xtype:'hidden',name:'form_type_pengeluaranKas',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'ref_id'},{xtype:'hidden',name:'supplier_id'},{xtype:'hidden',name:'jurnal_id'},{xtype:'hidden',name:'kk_status'},{xtype:'hidden',name:'old_kk_tujuan'},{xtype:'hidden',name:'kk_tujuan'},{xtype:'hidden',name:'autoposting_id'},{xtype:'hidden',name:'cashflow_non_accounting'},{xtype:'hidden',name:'kk_info'},{xtype:'textfield',name:'kk_no',fieldLabel:'Pengeluaran. No',width:250,value:'Auto',labelWidth:120,labelSeparator:'',readOnly:true},{xtype:'datefield',name:'kk_date',width:250,fieldLabel:'Tgl Pengeluaran',format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false,labelWidth:120,labelSeparator:''},{xtype:'textfield',name:'kk_name',fieldLabel:'Nama/Pelaksana',width:350,allowBlank:false,labelWidth:120,labelSeparator:''},{xtype:'textfield',name:'no_ref',fieldLabel:'No.Bukti',width:350,allowBlank:false,labelWidth:120,labelSeparator:''}]},{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:260,border:false,margin:'0 10 0 0',items:[{xtype:'displayfield',name:'kk_status_text',fieldLabel:'Status',width:250,labelWidth:80,labelSeparator:''},{xtype:'textfield',name:'jurnal_no',fieldLabel:'Jurnal No',value:'Auto',width:250,labelWidth:80,labelSeparator:'',readOnly:true},{xtype:'textfield',name:'posting_no',fieldLabel:'Posting No',value:'Auto',width:250,labelWidth:80,labelSeparator:'',readOnly:true},{xtype:'textfield',name:'kk_total',fieldLabel:'Total Keluar',width:250,labelWidth:80,allowBlank:false,labelSeparator:'',listeners:{blur:function(field,val){var form=Ext.getCmp('form_pengeluaranKas').getForm();form.findField('kk_total').setValue(phpJs.priceFormat(form.findField('kk_total').getValue()));},focus:function(){var form=Ext.getCmp('form_pengeluaranKas').getForm();var get_kk_total=phpJs.numberFormat(form.findField('kk_total').getValue());if(get_kk_total==0){get_kk_total='';}
form.findField('kk_total').setValue(get_kk_total);}}}]}]},{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'combobox',name:'kk_tujuan_text',fieldLabel:'Tujuan',emptyText:'Pilih',width:650,store:store_tujuanPengeluaran_addPengeluaran,displayField:'tujuan_cashflow_name',valueField:'id',queryMode:'local',allowBlank:false,labelWidth:120,labelSeparator:'',margin:'0 0 5 0',listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_pengeluaranKas').getForm();form2.findField('kk_tujuan').setValue(records[0].data.id);}}},{xtype:'combobox',name:'autoposting_name',fieldLabel:'Jenis Pengeluaran',emptyText:'Pilih',width:650,store:store_accAutoPosting_addPengeluaran,displayField:'autoposting_name',valueField:'id',queryMode:'local',allowBlank:false,labelWidth:120,labelSeparator:'',margin:'0 0 5 0',listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_pengeluaranKas').getForm();form2.findField('autoposting_id').setValue(records[0].data.id);}}},{xtype:'textfield',name:'kk_notes',fieldLabel:'Notes',width:650,labelWidth:120,labelSeparator:''}]}]}],buttons:[{text:'Save to Jurnal',formBind:true,id:'btnJurnal_pengeluaranKas',iconCls:'btn-posting',disabled:true,handler:function(){ExtApp.Msg.confirm('Save to Jurnal?</b></i>',false,function(btn){if(btn=='yes'){me.saveJurnal_pengeluaranKas();}else{return false;}});}},{text:'Posting Jurnal',formBind:true,id:'btnPosting_pengeluaranKas',iconCls:'btn-posting',disabled:true,handler:function(){ExtApp.Msg.confirm('Posting Jurnal?</b></i>',false,function(btn){if(btn=='yes'){me.save_pengeluaranKas(1);}else{return false;}});}},'->',{text:'Save',formBind:true,id:'btnSave_pengeluaranKas',iconCls:'btn-save',handler:function(){me.save_pengeluaranKas(0);}},{text:'Close',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_pengeluaranKas');}}],listeners:{show:function(){var form=Ext.getCmp('form_pengeluaranKas').getForm();form.reset();Ext.getCmp('btnJurnal_pengeluaranKas').hide();Ext.getCmp('btnPosting_pengeluaranKas').hide();Ext.getCmp('btnSave_pengeluaranKas').setDisabled(false);if(is_cashflow_non_accounting==1){form.findField('cashflow_non_accounting').setValue(1);}else{form.findField('cashflow_non_accounting').setValue(0);}
if(form.findField('form_type_pengeluaranKas').getValue()=='add'){form.findField('kk_date').setValue(phpJs.date("d-m-Y"));form.findField('kk_date').setReadOnly(false);store_accAutoPosting_addPengeluaran.load({callback:function(){}});store_tujuanPengeluaran_addPengeluaran.load({callback:function(){}});form.findField('kk_status').setValue("pengakuan");form.findField('kk_status_text').setValue('<font color="blue">Pengakuan</font>');form.findField('kk_info').setValue("");var val={payment_type:1};Ext.getCmp('payment_id_group_pengeluaranKas').setValue(val);}else{if(me.edit_data.jurnal_no==''){me.edit_data.jurnal_no='-';}
if(me.edit_data.posting_no==''){me.edit_data.posting_no='-';}
form.setValues(me.edit_data);form.findField('kk_date').setReadOnly(true);form.findField('kk_name').setReadOnly(true);form.findField('no_ref').setReadOnly(true);form.findField('kk_total').setReadOnly(true);form.findField('autoposting_name').setDisabled(true);form.findField('kk_tujuan_text').setDisabled(true);form.findField('kk_info').setValue("");form.findField('kk_total').setValue(me.edit_data.kk_total_show);if(me.edit_data.kk_status=='pengakuan'){if(is_cashflow_non_accounting==1){}else{Ext.getCmp('btnJurnal_pengeluaranKas').setDisabled(false);Ext.getCmp('btnJurnal_pengeluaranKas').show();}
form.findField('kk_date').setReadOnly(true);form.findField('kk_name').setReadOnly(false);form.findField('no_ref').setReadOnly(false);form.findField('kk_total').setReadOnly(false);form.findField('autoposting_name').setDisabled(false);form.findField('kk_tujuan_text').setDisabled(false);}else
if(me.edit_data.kk_status=='jurnal'){}else
if(me.edit_data.kk_status=='posting'){if(is_cashflow_non_accounting==1){form.findField('kk_date').setReadOnly(false);form.findField('kk_total').setReadOnly(false);form.findField('autoposting_name').setDisabled(false);form.findField('kk_tujuan_text').setDisabled(false);}}
store_accAutoPosting_addPengeluaran.load({callback:function(){form.findField('autoposting_name').setValue(me.edit_data.autoposting_name);}});store_tujuanPengeluaran_addPengeluaran.load({callback:function(){form.findField('kk_tujuan_text').setValue(me.edit_data.kk_tujuan_text);}});}
me.reset_pengeluaranKasDetail();}}});}});