/**
 * Filename: inventory.distributionItem.js
 * Generated 2019-03-07 at 01:39:00 AM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterItemDistribution',{extend:'Ext.data.Model',alias:'model_masterItemDistribution',fields:[{name:'id',type:'int'},{name:'item_code',type:'string'},{name:'item_name',type:'string'},{name:'item_code_name',type:'string'},{name:'sales_price',type:'string'},{name:'sales_price_show',type:'string'},{name:'item_price',type:'string'},{name:'item_price_show',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'unit_id',type:'int'},{name:'unit_name',type:'string'},{name:'last_in_item',type:'string'},{name:'use_stok_kode_unik',type:'int'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterItem/gridDataDistribution',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterUnit',{extend:'Ext.data.Model',alias:'model_masterUnit',fields:[{name:'id',type:'int'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterUnit/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterStoreHouse',{extend:'Ext.data.Model',alias:'model_masterStoreHouse',fields:[{name:'id',type:'int'},{name:'storehouse_code',type:'string'},{name:'storehouse_name',type:'string'},{name:'storehouse_desc',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'is_primary',type:'int'},{name:'is_primary_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterStoreHouse/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_distributionItem',{extend:'Ext.data.Model',alias:'model_distributionItem',fields:[{name:'id',type:'int'},{name:'dis_number',type:'string'},{name:'dis_date',type:'string'},{name:'dis_memo',type:'string'},{name:'dis_deliver',type:'string'},{name:'dis_receiver',type:'string'},{name:'dis_status',type:'string'},{name:'dis_status_text',type:'string'},{name:'is_retur',type:'string'},{name:'is_retur_text',type:'string'},{name:'divisi_id',type:'string'},{name:'divisi_name',type:'string'},{name:'delivery_from',type:'int'},{name:'delivery_from_name',type:'string'},{name:'delivery_to',type:'int'},{name:'delivery_to_name',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/distributionItem/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_distributionItemDetail',{extend:'Ext.data.Model',alias:'model_distributionItemDetail',fields:[{name:'id',type:'string'},{name:'dis_id',type:'string'},{name:'item_id',type:'string'},{name:'disd_dikirim',type:'string'},{name:'disd_diterima',type:'string'},{name:'disd_diterima_before',type:'string'},{name:'item_code',type:'string'},{name:'item_name',type:'string'},{name:'item_code_name',type:'string'},{name:'item_price',type:'string'},{name:'item_hpp',type:'string'},{name:'disd_status',type:'string'},{name:'dis_status_text',type:'string'},{name:'unit_name',type:'string'},{name:'unit_id',type:'string'},{name:'nomor',type:'int'}],proxy:{type:'ajax',url:appUrl+'inventory/distributionItem/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_listStockDetail',{extend:'Ext.data.Model',alias:'model_listStockDetail',fields:[{name:'id',type:'string'},{name:'storehouse_id',type:'string'},{name:'item_id',type:'string'},{name:'item_code',type:'string'},{name:'item_name',type:'string'},{name:'total_stock_kemarin',type:'string'},{name:'total_stock_in',type:'string'},{name:'total_stock_out',type:'string'},{name:'total_stock',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'sales_price',type:'string'},{name:'sales_price_show',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'use_for_sales',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/listStock/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterItemDistribution',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterItemDistribution',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterUnit',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterUnit',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterStoreHouse',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterStoreHouse',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_distributionItem',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_distributionItem',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_distributionItemDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_distributionItemDetail',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_listStockDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_listStockDetail',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.inventory.view.distributionItem",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_distributionItem_grid=theApp.getStore('store_distributionItem_grid',false);if(store_distributionItem_grid==false){store_distributionItem_grid=theApp.copyStore('inventory','store_distributionItem','store_distributionItem_grid');}
store_distributionItem_grid.proxy.extraParams.not_cancel=true;var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_distributionItem=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_distributionItem').down('#deleteButton_distributionItem').setDisabled(selections.length==0);}}});me.pagingtb_distributionItem=helperGrid.paging({ds:store_distributionItem_grid,title:'Distribution'});return desktop.createWindow({id:me.id,title:'Distribution',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_distributionItem',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: NO',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_distributionItem();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('d-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('d-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_distributionItem',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_distributionItem();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_distributionItem',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_distributionItem').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-m-Y'));form.findField('date_till').setValue(phpJs.date('t-m-Y'));me.search_distributionItem();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_distributionItem_grid,id:'grid_distributionItem',scroll:true,selModel:selModel_distributionItem,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'dis_number',text:'NO',width:100},{xtype:'datecolumn',dataIndex:'dis_date',text:'Date',width:100,format:'d-m-Y'},{xtype:'gridcolumn',dataIndex:'dis_status_text',text:'Status',width:80},{xtype:'gridcolumn',dataIndex:'delivery_from_name',text:'From',width:150},{xtype:'gridcolumn',dataIndex:'delivery_to_name',text:'To',width:150},{xtype:'gridcolumn',dataIndex:'is_retur_text',text:'Retur',width:80},{xtype:'gridcolumn',dataIndex:'dis_memo',text:'Memo',width:200}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_distributionItem').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_distributionItem');}}},bbar:me.pagingtb_distributionItem,dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_distributionItem',tooltip:'Filter Distribution',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_distributionItem').toggleCollapse();}}},'->',{text:'Add',itemId:'addButton_distributionItem',tooltip:'Add Distribution',iconCls:'btn-add',listeners:{click:function(){me.formType='add';me.edit_data=[];me.createWindow(me,'add_distributionItem');}}},'-',{text:'Cancel',itemId:'deleteButton_distributionItem',tooltip:'Cancel Distribution',iconCls:'btn-delete',disabled:true,listeners:{click:function(){var getSelection=Ext.getCmp('grid_distributionItem').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;if(me.delete_data.dis_status=='take'||me.delete_data.dis_status=='validated'){ExtApp.Msg.warning('Cannot Cancel '+me.delete_data.dis_number+'<br/>Distribution been taken / used');}else{me.deleteConfirm_distributionItem();}}else{ExtApp.Msg.info('Please Select Distribution!');}}}},'-',{text:'Refresh',itemId:'refreshButton_distributionItem',tooltip:'Refresh Distribution',iconCls:'btn-refresh',listeners:{click:function(){me.search_distributionItem();}}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_distributionItem').toggleCollapse();me.search_distributionItem();},show:function(){}}});},add_distributionItem:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add New Distribution';if(me.formType=='edit'){Titletext='Update Distribution';}
me.store_distributionItemDetailTemp=theApp.getStore('store_distributionItemDetailTemp',false);if(me.store_distributionItemDetailTemp==false){me.store_distributionItemDetailTemp=theApp.copyStore('inventory','store_distributionItemDetail','store_distributionItemDetailTemp');}
me.store_distributionItemDetailTemp.proxy.extraParams.limit=999999;var store_masterItem_distributionItemDetail=theApp.getStore('store_masterItem_distributionItemDetail',false);if(store_masterItem_distributionItemDetail==false){store_masterItem_distributionItemDetail=theApp.copyStore('master_pos','store_masterItemDistribution','store_masterItem_distributionItemDetail');}
store_masterItem_distributionItemDetail.proxy.extraParams.supplier_id=0;store_masterItem_distributionItemDetail.proxy.extraParams.item_id=0;store_masterItem_distributionItemDetail.proxy.extraParams.skip_date=1;store_masterItem_distributionItemDetail.proxy.extraParams.limit=999999;store_masterItem_distributionItemDetail.proxy.extraParams.is_last_stock=0;store_masterItem_distributionItemDetail.proxy.extraParams.is_dropdown=1;store_masterItem_distributionItemDetail.proxy.extraParams.storehouse_id=0;store_masterItem_distributionItemDetail.proxy.extraParams.from_module='distribution';store_masterItem_distributionItemDetail.proxy.extraParams.keywords='';var store_MasterUnit_distributionItemDetail=theApp.getStore('store_MasterUnit_distributionItemDetail',false);if(store_MasterUnit_distributionItemDetail==false){store_MasterUnit_distributionItemDetail=theApp.copyStore('master_pos','store_masterUnit','store_MasterUnit_distributionItemDetail');}
store_MasterUnit_distributionItemDetail.proxy.extraParams.skip_date=1;store_MasterUnit_distributionItemDetail.proxy.extraParams.limit=999999;store_MasterUnit_distributionItemDetail.proxy.extraParams.is_dropdown=1;store_MasterUnit_distributionItemDetail.proxy.extraParams.keywords='';var store_DeliveryFrom_distributionItemDetail=theApp.getStore('store_DeliveryFrom_distributionItemDetail',false);if(store_DeliveryFrom_distributionItemDetail==false){store_DeliveryFrom_distributionItemDetail=theApp.copyStore('master_pos','store_masterStoreHouse','store_DeliveryFrom_distributionItemDetail');}
store_DeliveryFrom_distributionItemDetail.proxy.extraParams.limit=999999;store_DeliveryFrom_distributionItemDetail.proxy.extraParams.is_dropdown=1;store_DeliveryFrom_distributionItemDetail.proxy.extraParams.except_primary=1;store_DeliveryFrom_distributionItemDetail.proxy.extraParams.is_active=1;store_DeliveryFrom_distributionItemDetail.proxy.extraParams.show_all_text=0;store_DeliveryFrom_distributionItemDetail.proxy.extraParams.show_choose_text=1;store_DeliveryFrom_distributionItemDetail.proxy.extraParams.keywords='';var store_DeliveryTo_distributionItemDetail=theApp.getStore('store_DeliveryTo_distributionItemDetail',false);if(store_DeliveryTo_distributionItemDetail==false){store_DeliveryTo_distributionItemDetail=theApp.copyStore('master_pos','store_masterStoreHouse','store_DeliveryTo_distributionItemDetail');}
store_DeliveryTo_distributionItemDetail.proxy.extraParams.skip_date=1;store_DeliveryTo_distributionItemDetail.proxy.extraParams.limit=999999;store_DeliveryTo_distributionItemDetail.proxy.extraParams.is_dropdown=1;store_DeliveryTo_distributionItemDetail.proxy.extraParams.except_primary=0;store_DeliveryTo_distributionItemDetail.proxy.extraParams.is_active=1;store_DeliveryTo_distributionItemDetail.proxy.extraParams.show_all_text=0;store_DeliveryTo_distributionItemDetail.proxy.extraParams.show_choose_text=1;store_DeliveryTo_distributionItemDetail.proxy.extraParams.keywords='';me.store_lastStock_distributionItemDetail=theApp.getStore('store_lastStock_distributionItemDetail',false);if(me.store_lastStock_distributionItemDetail==false){me.store_lastStock_distributionItemDetail=theApp.copyStore('inventory','store_listStockDetail','store_lastStock_distributionItemDetail');}
me.store_lastStock_distributionItemDetail.proxy.extraParams.limit=999999;me.store_lastStock_distributionItemDetail.proxy.extraParams.closing_date='';me.store_lastStock_distributionItemDetail.proxy.extraParams.storehouse_id=0;var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_distributionItemDetail=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_distributionItemDetail').down('#deleteButton_distributionItemDetail').setDisabled(selections.length==0);}}});return desktop.createWindow({id:me.id+'_add_distributionItem',title:Titletext,width:645,height:540,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'panel',height:490,margin:'0 0 10 0',border:false,items:[{xtype:'form',id:'form_distributionItem',border:0,bodyPadding:10,border:true,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_distributionItem',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'textfield',name:'dis_number',fieldLabel:'NO',labelWidth:90,width:250,disabled:true,value:'auto',allowBlank:false},{xtype:'datefield',name:'dis_date',margin:'3 5 0 10',labelWidth:90,width:250,fieldLabel:'Date',format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false}]},{xtype:'hidden',name:'delivery_from'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'combobox',name:'delivery_from_name',fieldLabel:'Delivery From',emptyText:'Pilih Gudang',labelWidth:90,width:250,store:store_DeliveryFrom_distributionItemDetail,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_distributionItem').getForm();form2.findField('delivery_from').setValue(records[0].data.id);form2.findField('delivery_from_name').setValue(records[0].data.storehouse_name);var myMask2=new Ext.LoadMask(Ext.getCmp('add_item_id_DistributionItem'),{msg:"Loading..."});myMask2.show();me.store_lastStock_distributionItemDetail.proxy.extraParams.storehouse_id=records[0].data.id;store_masterItem_distributionItemDetail.proxy.extraParams.storehouse_id=records[0].data.id;store_masterItem_distributionItemDetail.load({callback:function(){myMask2.hide();}});}}},{xtype:'textfield',margin:'3 5 0 10',fieldLabel:'Delivery By :',name:'dis_deliver',labelWidth:90,width:325,allowBlank:false}]},{xtype:'hidden',name:'delivery_to'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'combobox',name:'delivery_to_name',fieldLabel:'Delivery To',emptyText:'Pilih Gudang',labelWidth:90,width:250,store:store_DeliveryTo_distributionItemDetail,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_distributionItem').getForm();form2.findField('delivery_to').setValue(records[0].data.id);form2.findField('delivery_to_name').setValue(records[0].data.storehouse_name);}}},{xtype:'textfield',margin:'3 5 0 10',fieldLabel:'Received By :',name:'dis_receiver',labelWidth:90,width:325,allowBlank:false}]},{xtype:'textfield',name:'dis_memo',fieldLabel:'Memo',labelWidth:90,width:585,allowBlank:true},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'checkbox',name:'is_retur',fieldLabel:'Retur',inputValue:'1',labelWidth:90,margin:'0 270 0 0',},{xtype:'button',iconCls:'btn-add',name:'btnAddAll_distributionItemDetail',id:'btnAddAll_distributionItemDetail',width:220,text:'Tambahkan Semua Data Gudang',handler:function(){me.addAll_distributionItemDetail();}}]}]},{xtype:'form',border:true,id:'form_distributionItemDetail',bodyBorder:false,bodyPadding:10,title:'',pollForChanges:false,layout:{type:'auto'},items:[{xtype:'panel',layout:{type:'hbox',align:'left'},margin:'0 0 10 0',border:false,items:[{xtype:'hidden',name:'form_type_distributionItemDetail',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'dis_id'},{xtype:'hidden',name:'disd_status'},{xtype:'hidden',name:'disd_diterima'},{xtype:'hidden',name:'item_id'},{xtype:'hidden',name:'item_name'},{xtype:'hidden',name:'item_code'},{xtype:'hidden',name:'item_hpp'},{xtype:'hidden',name:'item_price'},{xtype:'hidden',name:'unit_id'},{xtype:'combobox',name:'item_code_name',id:'add_item_id_DistributionItem',fieldLabel:'Items',hideLabel:true,emptyText:'-Select Items (Auto complete)-',width:260,style:'margin-right:5px',allowBlank:false,store:store_masterItem_distributionItemDetail,displayField:'item_code_name',valueField:'id',hideTrigger:true,queryMode:'local',anyMatch:true,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_distributionItem').getForm();var form2=Ext.getCmp('form_distributionItemDetail').getForm();form2.findField('dis_id').setValue(form.findField('id').getValue());form2.findField('item_id').setValue(records[0].data.id);form2.findField('item_hpp').setValue(records[0].data.item_hpp);form2.findField('item_price').setValue(records[0].data.item_price);form2.findField('item_code_name').setValue(records[0].data.item_code_name);form2.findField('item_code').setValue(records[0].data.item_code);form2.findField('item_name').setValue(records[0].data.item_name);form2.findField('unit_id').setValue(records[0].data.unit_id);form2.findField('unit_name').setValue(records[0].data.unit_name);form2.findField('unit_name_show').setValue(records[0].data.unit_name);},specialkey:function(field,e){var form2=Ext.getCmp('form_distributionItemDetail').getForm();if(e.getKey()==e.ENTER){form2.findField('disd_dikirim').focus();}}}},{xtype:'numberfield',name:'disd_dikirim',fieldLabel:'Qty',emptyText:'-Qty-',hideLabel:true,style:'margin-right:5px',width:80,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false,listeners:{specialkey:function(field,e){var form2=Ext.getCmp('form_distributionItemDetail').getForm();if(e.getKey()==e.ENTER){form2.findField('item_name').focus();me.add_distributionItemDetail();}}}},{xtype:'displayfield',name:'unit_name_show',fieldLabel:'Unit',hideLabel:true,emptyText:'-Unit Name-',value:'-',width:90,style:'margin-right:5px',readOnly:true,allowBlank:true},{xtype:'hidden',name:'unit_name',fieldLabel:'Unit',hideLabel:true,emptyText:'-Unit Name-',width:110,style:'margin-right:5px',readOnly:true,allowBlank:true},{xtype:'button',iconCls:'btn-add',name:'btnAdd_distributionItemDetail',id:'btnAdd_distributionItemDetail',width:70,text:'Add',margin:'0 10 0 10',handler:function(){me.add_distributionItemDetail();}},{xtype:'button',iconCls:'btn-reset',name:'btnReset_distributionItemDetail',id:'btnReset_distributionItemDetail',width:70,text:'Reset',handler:function(){me.reset_distributionItemDetail();}}]},{xtype:'panel',margin:'0 0 0 0',layout:'table',border:false,items:[{xtype:'gridpanel',store:me.store_distributionItemDetailTemp,id:'grid_distributionItemDetail',selModel:selModel_distributionItemDetail,scroll:true,width:610,height:220,border:true,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'Detail ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_id',text:'Supply ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_hpp',text:'HPP',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_price',text:'Price',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_code_name',text:'Price',hidden:true,hideable:false},{xtype:'gridcolumn',width:150,dataIndex:'item_code',text:'Kode',sortable:false},{xtype:'gridcolumn',width:150,dataIndex:'item_name',text:'Nama Barang',sortable:false},{xtype:'gridcolumn',width:85,dataIndex:'disd_dikirim',text:'Qty Kirim',sortable:false},{xtype:'gridcolumn',width:85,dataIndex:'disd_diterima',text:'Qty Terima',sortable:false},{xtype:'gridcolumn',width:110,dataIndex:'unit_name',text:'Unit',sortable:false},],listeners:{itemdblclick:function(view,rec,item,index,eventObj){if(!me.edit_data){}else{if(me.edit_data.dis_status=='done'){ExtApp.Msg.warning('Tidak bisa ubah data, Ubah Status Distribution ke Progress dan Simpan!');return true;}}
var form=Ext.getCmp('form_distributionItemDetail').getForm();form.reset();me.data_DistributionDetail=rec.data;form.setValues(me.data_DistributionDetail);form.findField('add_item_id_DistributionItem').setValue(me.data_DistributionDetail.item_code_name);form.findField('form_type_distributionItemDetail').setValue('edit');form.findField('unit_name_show').setValue(me.data_DistributionDetail.unit_name);Ext.getCmp('btnAdd_distributionItemDetail').setText('Edit');}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Delete',itemId:'deleteButton_distributionItemDetail',tooltip:'Delete Distribution Detail',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_distributionItemDetail').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;if(me.delete_data.disd_status=='take'){ExtApp.Msg.info('Cannot delete validated item!');}else{me.deleteConfirm_distributionItemDetail();}}else{ExtApp.Msg.info('Please select the data to be deleted!');}}},]}]}]}]}]}],buttons:[{text:'Print',formBind:true,id:'btnPrint_distributionItem',iconCls:'btn-print',disabled:true,handler:function(){me.print_distributionItem();}},'->',{text:'Save',formBind:true,id:'btnSave_distributionItem',iconCls:'btn-save',handler:function(){me.save_distributionItem();}},{text:'Close',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_distributionItem');}}],listeners:{show:function(){var form=Ext.getCmp('form_distributionItem').getForm();var formD=Ext.getCmp('form_distributionItemDetail').getForm();var dis_id=-1;var rowguid=0;form.reset();Ext.getCmp('btnSave_distributionItem').setDisabled(false);form.findField('dis_date').setDisabled(false);form.findField('delivery_from_name').setDisabled(false);form.findField('delivery_to_name').setDisabled(false);if(form.findField('form_type_distributionItem').getValue()=='add'){form.findField('dis_date').setValue(phpJs.date("d-m-Y"));Ext.getCmp('btnPrint_distributionItem').setDisabled(true);me.store_distributionItemDetailTemp.proxy.extraParams.dis_id=dis_id;me.store_distributionItemDetailTemp.loadData([]);store_DeliveryFrom_distributionItemDetail.load();store_DeliveryTo_distributionItemDetail.load();store_MasterUnit_distributionItemDetail.load();var myMask=new Ext.LoadMask(Ext.getCmp('add_item_id_DistributionItem'),{msg:"Loading..."});myMask.show();store_masterItem_distributionItemDetail.load({callback:function(){myMask.hide();}});}else{form.setValues(me.edit_data);Ext.getCmp('btnPrint_distributionItem').setDisabled(false);var dis_id=me.edit_data.id;formD.findField('dis_id').setValue(dis_id);store_DeliveryFrom_distributionItemDetail.load();store_DeliveryTo_distributionItemDetail.load();store_MasterUnit_distributionItemDetail.load();var myMask=new Ext.LoadMask(Ext.getCmp('add_item_id_DistributionItem'),{msg:"Loading..."});myMask.show();store_masterItem_distributionItemDetail.proxy.extraParams.storehouse_id=me.edit_data.delivery_from;store_masterItem_distributionItemDetail.load({callback:function(){myMask.hide();}});Ext.getCmp('btnAddAll_distributionItemDetail').setDisabled(false);Ext.getCmp('btnAdd_distributionItemDetail').setDisabled(false);if(me.edit_data.dis_status=='done'){Ext.getCmp('btnAddAll_distributionItemDetail').setDisabled(true);Ext.getCmp('btnAdd_distributionItemDetail').setDisabled(true);}
var myMask2=new Ext.LoadMask(Ext.getCmp('grid_distributionItemDetail'),{msg:"Loading..."});myMask2.show();me.store_distributionItemDetailTemp.proxy.extraParams.dis_id=dis_id;me.store_distributionItemDetailTemp.proxy.extraParams.limit=99999;me.store_distributionItemDetailTemp.load({callback:function(){myMask2.hide();}});if(me.edit_data.dis_status=='done'){form.findField('dis_date').setDisabled(true);form.findField('delivery_from_name').setDisabled(true);form.findField('delivery_to_name').setDisabled(true);}}
me.reset_distributionItemDetail()}}});}});