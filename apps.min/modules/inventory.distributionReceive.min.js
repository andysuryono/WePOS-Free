/**
 * Filename: inventory.distributionReceive.js
 * Generated 2019-03-07 at 01:39:04 AM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterStoreHouse',{extend:'Ext.data.Model',alias:'model_masterStoreHouse',fields:[{name:'id',type:'int'},{name:'storehouse_code',type:'string'},{name:'storehouse_name',type:'string'},{name:'storehouse_desc',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'is_primary',type:'int'},{name:'is_primary_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterStoreHouse/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_distributionItem',{extend:'Ext.data.Model',alias:'model_distributionItem',fields:[{name:'id',type:'int'},{name:'dis_number',type:'string'},{name:'dis_date',type:'string'},{name:'dis_memo',type:'string'},{name:'dis_deliver',type:'string'},{name:'dis_receiver',type:'string'},{name:'dis_status',type:'string'},{name:'dis_status_text',type:'string'},{name:'is_retur',type:'string'},{name:'is_retur_text',type:'string'},{name:'divisi_id',type:'string'},{name:'divisi_name',type:'string'},{name:'delivery_from',type:'int'},{name:'delivery_from_name',type:'string'},{name:'delivery_to',type:'int'},{name:'delivery_to_name',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/distributionItem/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_distributionItemDetail',{extend:'Ext.data.Model',alias:'model_distributionItemDetail',fields:[{name:'id',type:'string'},{name:'dis_id',type:'string'},{name:'item_id',type:'string'},{name:'disd_dikirim',type:'string'},{name:'disd_diterima',type:'string'},{name:'disd_diterima_before',type:'string'},{name:'item_code',type:'string'},{name:'item_name',type:'string'},{name:'item_code_name',type:'string'},{name:'item_price',type:'string'},{name:'item_hpp',type:'string'},{name:'disd_status',type:'string'},{name:'dis_status_text',type:'string'},{name:'unit_name',type:'string'},{name:'unit_id',type:'string'},{name:'nomor',type:'int'}],proxy:{type:'ajax',url:appUrl+'inventory/distributionItem/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterStoreHouse',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterStoreHouse',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_distributionReceive',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_distributionItem',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_distributionReceiveDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_distributionItemDetail',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.inventory.view.distributionReceive",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_distributionReceive_grid=theApp.getStore('store_distributionReceive_grid',false);if(store_distributionReceive_grid==false){store_distributionReceive_grid=theApp.copyStore('inventory','store_distributionReceive','store_distributionReceive_grid');}
store_distributionReceive_grid.proxy.extraParams.not_cancel=true;var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_distributionReceive=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){}}});me.pagingtb_distributionReceive=helperGrid.paging({ds:store_distributionReceive_grid,title:'Distribution'});return desktop.createWindow({id:me.id,title:'Distribution (Receive)',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_distributionReceive',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: NO',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_distributionReceive();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('d-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('d-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_distributionReceive',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_distributionReceive();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_distributionReceive',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_distributionReceive').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-m-Y'));form.findField('date_till').setValue(phpJs.date('t-m-Y'));me.search_distributionReceive();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_distributionReceive_grid,id:'grid_distributionReceive',scroll:true,selModel:selModel_distributionReceive,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'dis_number',text:'NO',width:100},{xtype:'datecolumn',dataIndex:'dis_date',text:'Date',width:100,format:'d-m-Y'},{xtype:'gridcolumn',dataIndex:'dis_status_text',text:'Status',width:80},{xtype:'gridcolumn',dataIndex:'delivery_from_name',text:'From',width:150},{xtype:'gridcolumn',dataIndex:'delivery_to_name',text:'To',width:150},{xtype:'gridcolumn',dataIndex:'is_retur_text',text:'Retur',width:80},{xtype:'gridcolumn',dataIndex:'dis_memo',text:'Memo',width:200}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_distributionReceive').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_distributionReceive');}}},bbar:me.pagingtb_distributionReceive,dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_distributionReceive',tooltip:'Filter Distribution',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_distributionReceive').toggleCollapse();}}},'->',{text:'Refresh',itemId:'refreshButton_distributionReceive',tooltip:'Refresh Distribution',iconCls:'btn-refresh',listeners:{click:function(){me.search_distributionReceive();}}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_distributionReceive').toggleCollapse();me.search_distributionReceive();},show:function(){}}});},add_distributionReceive:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add New Distribution';if(me.formType=='edit'){Titletext='Update Distribution';}
me.store_distributionReceiveDetailTemp=theApp.getStore('store_distributionReceiveDetailTemp',false);if(me.store_distributionReceiveDetailTemp==false){me.store_distributionReceiveDetailTemp=theApp.copyStore('inventory','store_distributionReceiveDetail','store_distributionReceiveDetailTemp');}
me.store_distributionReceiveDetailTemp.proxy.extraParams.limit=999999;var store_MasterStoreHouse_DeliveryFrom_distributionReceive=theApp.getStore('store_MasterStoreHouse_DeliveryFrom_distributionReceive',false);if(store_MasterStoreHouse_DeliveryFrom_distributionReceive==false){store_MasterStoreHouse_DeliveryFrom_distributionReceive=theApp.copyStore('master_pos','store_masterStoreHouse','store_MasterStoreHouse_DeliveryFrom_distributionReceive');}
store_MasterStoreHouse_DeliveryFrom_distributionReceive.proxy.extraParams.limit=999999;store_MasterStoreHouse_DeliveryFrom_distributionReceive.proxy.extraParams.is_dropdown=1;store_MasterStoreHouse_DeliveryFrom_distributionReceive.proxy.extraParams.except_primary=1;store_MasterStoreHouse_DeliveryFrom_distributionReceive.proxy.extraParams.is_active=1;store_MasterStoreHouse_DeliveryFrom_distributionReceive.proxy.extraParams.show_all_text=0;store_MasterStoreHouse_DeliveryFrom_distributionReceive.proxy.extraParams.show_choose_text=1;store_MasterStoreHouse_DeliveryFrom_distributionReceive.proxy.extraParams.keywords='';var store_MasterStoreHouse_DeliveryTo_distributionReceive=theApp.getStore('store_MasterStoreHouse_DeliveryTo_distributionReceive',false);if(store_MasterStoreHouse_DeliveryTo_distributionReceive==false){store_MasterStoreHouse_DeliveryTo_distributionReceive=theApp.copyStore('master_pos','store_masterStoreHouse','store_MasterStoreHouse_DeliveryTo_distributionReceive');}
store_MasterStoreHouse_DeliveryTo_distributionReceive.proxy.extraParams.limit=999999;store_MasterStoreHouse_DeliveryTo_distributionReceive.proxy.extraParams.is_dropdown=1;store_MasterStoreHouse_DeliveryTo_distributionReceive.proxy.extraParams.except_primary=0;store_MasterStoreHouse_DeliveryTo_distributionReceive.proxy.extraParams.is_active=1;store_MasterStoreHouse_DeliveryTo_distributionReceive.proxy.extraParams.show_all_text=0;store_MasterStoreHouse_DeliveryTo_distributionReceive.proxy.extraParams.show_choose_text=1;store_MasterStoreHouse_DeliveryTo_distributionReceive.proxy.extraParams.keywords='';var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_distributionReceiveDetail=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){}}});return desktop.createWindow({id:me.id+'_add_distributionReceive',title:Titletext,width:645,height:540,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'panel',height:490,margin:'0 0 10 0',border:false,items:[{xtype:'form',id:'form_distributionReceive',border:0,bodyPadding:10,border:true,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_distributionReceive',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'textfield',name:'dis_number',fieldLabel:'NO',labelWidth:90,width:250,disabled:true,value:'auto',allowBlank:false},{xtype:'datefield',name:'dis_date',margin:'3 5 0 10',labelWidth:90,width:250,fieldLabel:'Date',format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false}]},{xtype:'hidden',name:'delivery_from'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'combobox',name:'delivery_from_name',fieldLabel:'Delivery From',emptyText:'Pilih Gudang',labelWidth:90,width:250,store:store_MasterStoreHouse_DeliveryFrom_distributionReceive,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,readOnly:true,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_distributionReceive').getForm();form2.findField('delivery_from').setValue(records[0].data.id);form2.findField('delivery_from_name').setValue(records[0].data.storehouse_name);}}},{xtype:'textfield',margin:'3 5 0 10',fieldLabel:'Delivery By :',name:'dis_deliver',labelWidth:90,width:325,readOnly:true,allowBlank:false}]},{xtype:'hidden',name:'delivery_to'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'combobox',name:'delivery_to_name',fieldLabel:'Delivery To',emptyText:'Pilih Gudang',labelWidth:90,width:250,store:store_MasterStoreHouse_DeliveryTo_distributionReceive,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,readOnly:true,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_distributionReceive').getForm();form2.findField('delivery_to').setValue(records[0].data.id);form2.findField('delivery_to_name').setValue(records[0].data.storehouse_name);}}},{xtype:'textfield',margin:'3 5 0 10',fieldLabel:'Received By :',name:'dis_receiver',labelWidth:90,width:325,allowBlank:false}]},{xtype:'textfield',name:'dis_memo',fieldLabel:'Memo',labelWidth:90,width:590,allowBlank:true},{xtype:'hidden',name:'dis_status_old'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'radiogroup',fieldLabel:'Status',labelWidth:90,width:300,items:[{xtype:'radiofield',boxLabel:'Progress',name:'dis_status',inputValue:'progress',id:'dis_progress'},{xtype:'radiofield',boxLabel:'Done/Selesai',name:'dis_status',inputValue:'done',id:'dis_done'}]},{xtype:'button',iconCls:'btn-tick',name:'btnAutoDiterima_distributionReceiveDetail',id:'btnAutoDiterima_distributionReceiveDetail',width:150,text:'Set Di Terima Semua',margin:'0 10 0 10',handler:function(){me.terimasemua_distributionReceiveDetail();}},{xtype:'displayfield',name:'is_retur_text',fieldLabel:'',labelWidth:0,allowBlank:true}]}]},{xtype:'form',border:true,id:'form_distributionReceiveDetail',bodyBorder:false,bodyPadding:10,title:'',pollForChanges:false,layout:{type:'auto'},items:[{xtype:'panel',layout:{type:'hbox',align:'left'},margin:'0 0 10 0',border:false,items:[{xtype:'hidden',name:'form_type_distributionReceiveDetail',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'dis_id'},{xtype:'hidden',name:'disd_status'},{xtype:'hidden',name:'disd_dikirim'},{xtype:'hidden',name:'disd_dikirim_before'},{xtype:'hidden',name:'unit_id'},{xtype:'hidden',name:'item_id'},{xtype:'hidden',name:'item_hpp'},{xtype:'hidden',name:'item_price'},{xtype:'hidden',name:'item_name'},{xtype:'hidden',name:'item_code'},{xtype:'textfield',name:'item_code_name',id:'add_item_id_DistributionItemReceive',fieldLabel:'Items',hideLabel:true,emptyText:'-Item Name-',width:250,style:'margin-right:5px',allowBlank:true,readOnly:true},{xtype:'numberfield',name:'disd_diterima',fieldLabel:'Qty Terima',emptyText:'- Qty Terima -',hideLabel:true,style:'margin-right:5px',width:90,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){var form2=Ext.getCmp('form_distributionReceiveDetail').getForm();if(e.getKey()==e.ENTER){form2.findField('disd_diterima').focus();me.add_distributionReceiveDetail();}}}}},{xtype:'displayfield',name:'unit_name_show',fieldLabel:'Unit',hideLabel:true,emptyText:'-Unit Name-',value:'-',width:90,style:'margin-right:5px',readOnly:true,allowBlank:true},{xtype:'hidden',name:'unit_name',fieldLabel:'Unit',hideLabel:true,emptyText:'-Unit Name-',width:110,style:'margin-right:5px',readOnly:true,allowBlank:true},{xtype:'button',iconCls:'btn-add',name:'btnAdd_distributionReceiveDetail',id:'btnAdd_distributionReceiveDetail',width:70,text:'Set Qty',margin:'0 10 0 10',handler:function(){me.add_distributionReceiveDetail();}},{xtype:'button',iconCls:'btn-reset',name:'btnReset_distributionReceiveDetail',id:'btnReset_distributionReceiveDetail',width:70,text:'Reset',handler:function(){me.reset_distributionReceiveDetail();}}]},{xtype:'panel',margin:'0 0 0 0',layout:'table',border:false,items:[{xtype:'gridpanel',store:me.store_distributionReceiveDetailTemp,id:'grid_distributionReceiveDetail',scroll:true,width:610,height:220,border:true,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'Detail ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_id',text:'Supply ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_hpp',text:'HPP',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_price',text:'Price',hidden:true,hideable:false},{xtype:'gridcolumn',width:120,dataIndex:'item_code',text:'Kode',sortable:false},{xtype:'gridcolumn',width:200,dataIndex:'item_name',text:'Nama Barang',sortable:false},{xtype:'gridcolumn',width:85,dataIndex:'disd_dikirim',text:'Qty Kirim',sortable:false},{xtype:'gridcolumn',width:85,dataIndex:'disd_diterima',text:'Qty Terima',sortable:false},{xtype:'gridcolumn',dataIndex:'disd_diterima_before',text:'QTY Terima Edit',hidden:true,hideable:false},{xtype:'gridcolumn',width:120,dataIndex:'unit_name',text:'Unit',sortable:false},],listeners:{itemdblclick:function(view,rec,item,index,eventObj){if(me.edit_data.dis_status=='done'){ExtApp.Msg.warning('Cannot Edit Item, Change Status Distribution to Progress and Save!');return true;}
var form=Ext.getCmp('form_distributionReceiveDetail').getForm();form.reset();me.data_DistributionDetail=rec.data;form.setValues(me.data_DistributionDetail);form.findField('form_type_distributionReceiveDetail').setValue('edit');Ext.getCmp('btnAdd_distributionReceiveDetail').setText('Set Qty');form.findField('unit_name_show').setValue(me.data_DistributionDetail.unit_name);form.findField('disd_diterima').focus();}},}]}]}]}],buttons:[{text:'Print',formBind:true,id:'btnPrint_distributionReceive',iconCls:'btn-print',disabled:true,handler:function(){me.print_distributionReceive();}},'->',{text:'Save',formBind:true,id:'btnSave_distributionReceive',iconCls:'btn-save',handler:function(){me.save_distributionReceive();}},{text:'Close',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_distributionReceive');}}],listeners:{show:function(){var form=Ext.getCmp('form_distributionReceive').getForm();var formD=Ext.getCmp('form_distributionReceiveDetail').getForm();var dis_id=-1;var rowguid=0;form.reset();Ext.getCmp('btnSave_distributionReceive').setDisabled(false);form.setValues(me.edit_data);Ext.getCmp('btnPrint_distributionReceive').setDisabled(false);var dis_id=me.edit_data.id;formD.findField('dis_id').setValue(dis_id);store_MasterStoreHouse_DeliveryFrom_distributionReceive.load();store_MasterStoreHouse_DeliveryTo_distributionReceive.load();if(me.edit_data.dis_status=='done'){Ext.getCmp('dis_progress').setValue(false);Ext.getCmp('dis_done').setValue(true);}else{Ext.getCmp('dis_progress').setValue(true);Ext.getCmp('dis_done').setValue(false);}
Ext.getCmp('btnAdd_distributionReceiveDetail').setDisabled(false);form.findField('dis_date').setDisabled(false);if(me.edit_data.dis_status=='done'){Ext.getCmp('btnAdd_distributionReceiveDetail').setDisabled(true);form.findField('dis_date').setDisabled(true);}
var myMask2=new Ext.LoadMask(Ext.getCmp('grid_distributionReceiveDetail'),{msg:"Loading..."});myMask2.show();me.store_distributionReceiveDetailTemp.proxy.extraParams.dis_id=dis_id;me.store_distributionReceiveDetailTemp.proxy.extraParams.limit=99999;me.store_distributionReceiveDetailTemp.load({callback:function(){myMask2.hide();}});if(me.edit_data.dis_status=='done'){}
me.reset_distributionReceiveDetail()}}});}});